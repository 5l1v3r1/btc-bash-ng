#!/bin/bash

testrfc6979_sign(){

	local -u key="${1}" datahex msg
	local databin="${2}"
    local -au kval

    read datahex < <( echo -n "${databin}" | bin2hex )
    sign_der "${key}" "${datahex}"
    # read msg < <( ${hashfun} "${datahex}" )
    # readarray -t kval < <( sigk "${key}" "${datahex}" )
    # bc <<<"sign(${kval[1]},${kval[0]},${msg},${key},nn)"
}

testrfc6979()
{
    testrfc6979_sign "1" "Satoshi Nakamoto"
#	data="5361746F736869204E616B616D6F746F"
    testrfc6979_sign "1" "All those moments will be lost in time, like tears in rain. Time to die..."
#	data="416C6C2074686F7365206D6F6D656E74732077696C6C206265206C6F737420696E2074696D652C206C696B6520746561727320696E207261696E2E2054696D6520746F206469652E2E2E"
	testrfc6979_sign "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364140" "Satoshi Nakamoto"
#   data="5361746F736869204E616B616D6F746F"

	testrfc6979_sign "F8B8AF8CE3C7CCA5E300D33939540C10D45CE001B8F252BFBC57BA0342904181" "Alan Turing"
#	data="416C616E20547572696E67"
	
    testrfc6979_sign "E91671C46231F833A6406CCBEA0E3E392C76C167BAC1CB013F6F1013980455C2" "There is a computer disease that anybody who works with computers knows about. It's a very serious disease and it interferes completely with the work. The trouble with computers is that you 'play' with them!"
#	data="5468657265206973206120636F6D70757465722064697365617365207468617420616E79626F64792077686F20776F726B73207769746820636F6D707574657273206B6E6F77732061626F75742E20497427732061207665727920736572696F7573206469736561736520616E6420697420696E746572666572657320636F6D706C6574656C7920776974682074686520776F726B2E205468652074726F75626C65207769746820636F6D707574657273206973207468617420796F752027706C6179272077697468207468656D21"
}

testrfc6979_secp256k1_sha256()
{
    local -a ret
    readarray -t ret < <( testrfc6979 )

    [[ "${ret[0]}" == "3045022100934B1EA10A4B3C1757E2B0C017D0B6143CE3C9A7E6A4A49860D7A6AB210EE3D802202442CE9D2B916064108014783E923EC36B49743E2FFA1C4496F01A512AAFD9E5" ]] && \
    [[ "${ret[1]}" == "30450221008600DBD41E348FE5C9465AB92D23E3DB8B98B873BEECD930736488696438CB6B0220547FE64427496DB33BF66019DACBF0039C04199ABB0122918601DB38A72CFC21" ]] && \
    [[ "${ret[2]}" == "3045022100FD567D121DB66E382991534ADA77A6BD3106F0A1098C231E47993447CD6AF2D002206B39CD0EB1BC8603E159EF5C20A5C8AD685A45B06CE9BEBED3F153D10D93BED5" ]] && \
    [[ "${ret[3]}" == "304402207063AE83E7F62BBB171798131B4A0564B956930092B33B07B395615D9EC7E15C022058DFCC1E00A35E1572F366FFE34BA0FC47DB1E7189759B9FB233C5B05AB388EA" ]] && \
    [[ "${ret[4]}" == "3045022100B552EDD27580141F3B2A5463048CB7CD3E047B97C9F98076C32DBDF85A68718B0220279FA72DD19BFAE05577E06C7C0C1900C371FCD5893F7E1D56A37D30174671F6" ]]
}

testrfc6979_secp256k1_sha256 || return 1
